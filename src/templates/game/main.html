{% set endpoint = api('game', [slug]) %}

{% defer (url=endpoint, as='game', key=slug, id='game-data') %}
  {% set game = this %}
  <masthead class="game-masthead">
    <div class="game-icon" style="background-image: url({{ game.icons[64] }})"></div>
    <div class="game-release-info">
      <h1 itemprop="name">{{ game.name|translate(game) }}</h1>
      {% if game.developer and game.developer.name %}
        <div class="author">
          {% if game.developer.url %}<a href="{{ game.developer_url }}">{% endif %}
          {{ game.developer.name }}
          {% if game.developer.url %}</a>{% endif %}
        </div>
      {% endif %}
      <dl>
        <dt>{{ _('Genre:') }}</dt><dd><a href="{{ url('genre', [game.genre]) }}">{{ settings.genres[game.genre] }}</a></dd>
        {% if game.created %}
          <dt>{{ _('Release Date:') }}</dt><dd><time>{{ game.created|date('long') }}</time></dd>
        {% endif %}
      </dl>
    </div>
    <div class="game-install">
      <button data-app-url="{{ game.app_url }}" class="btn btn-big btn-green play">{{ _('Play') }}</button>
    </div>
  </masthead>

  <section class="game-media">
    {# TODO: Screenshots and videos go here. #}
  </section>

  {# TODO: Links for admins/reviewers go here. #}

  <section class="game-details">
    <h3>{{ _('Description') }}</h3>
    <p class="description" itemprop="description">
      {{ this.description|translate(this)|nl2br }}
    </p>
    {% if game.homepage_url %}
      <a href="{{ game.homepage_url }}" rel="external">{{ _('Homepage') }}</a>
    {% endif %}
    {% if game.license %}
      {{ _('License:') }} {{ game.license }}
    {% endif %}
    {% if game.privacy_policy_url %}
      <a href="{{ game.privacy_policy_url }}" rel="external">{{ _('Privacy Policy') }}</a>
    {% endif %}
  </section>
{% placeholder %}
  <masthead class="game-masthead">
    <div>
      <h1>{{ _('Loading&hellip;') }}</h1>
    </div>
  </div>
{% except %}
  <div class="detailed-error">
    <h2>{{ _('Oh no!') }}</h2>
    {% if error == 403 %}
      <p>{{ _('The game requested is not public.') }}</p>
    {% elif error == 404 %}
      <p>{{ _('The game requested was not found.') }}</p>
    {% elif error == 451 %}
      <p>{{ _('The game requested is not available for your region.') }}</p>
      <p>{{ _('You may wish to contact the developer if you would like to see a version of this game for your region.') }}</p>
    {% else %}
      <p>{{ _('A server error occurred. Please try again later.') }}</p>
    {% endif %}
  </div>
{% end %}
